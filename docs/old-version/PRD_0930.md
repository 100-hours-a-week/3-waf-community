# PRD.md - Product Requirements Document

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | KTB Community Platform |
| 작성일 | 2025-09-30 |
| 버전 | 1.0 |
| 문서 유형 | Product Requirements Document |
| 대상 독자 | 개발자, PM, QA |

---

## 1. 제품 개요

### 1.1 프로젝트 목적
KTB Community Platform은 사용자들이 자유롭게 게시글을 작성하고, 댓글을 통해 소통하며, 좋아요를 통해 공감을 표현할 수 있는 커뮤니티 백엔드 서비스입니다.

### 1.2 프로젝트 범위
- **대상 사용자**: 일반 사용자, 관리자 (향후)
- **플랫폼**: RESTful API 기반 백엔드 (프론트엔드 별도)
- **배포 환경**: 백엔드 API 서버 (추후 배포 환경 결정)

---

## 2. 기능 요구사항

### 2.1 인증 및 권한 관리

#### 2.1.1 회원가입
**FR-AUTH-001: 회원가입**
- **설명**: 신규 사용자가 이메일과 비밀번호로 계정을 생성할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 이메일 (필수, 유니크, 이메일 형식 검증)
  - 비밀번호 (필수, 8-20자, 대/소문자/특수문자 각 1개 이상)
  - 닉네임 (필수, 10자 이하, 유니크)
  - 프로필 이미지 URL (선택)
- **출력**:
  - Access Token (30분 만료)
  - Refresh Token (7일 만료)
- **검증 규칙**:
  - 이메일 중복 확인
  - 닉네임 중복 확인
  - 비밀번호 정책 검증
  - 이메일은 소문자, 공백 제거 자동 처리
- **에러 처리**:
  - 중복 이메일/닉네임 시 409 에러
  - 유효하지 않은 입력 시 400 에러

#### 2.1.2 로그인
**FR-AUTH-002: 로그인**
- **설명**: 등록된 사용자가 이메일과 비밀번호로 로그인할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 이메일
  - 비밀번호
- **출력**:
  - Access Token
  - Refresh Token
- **검증 규칙**:
  - 이메일과 비밀번호 일치 확인
  - 계정 상태 확인 (ACTIVE만 로그인 가능)
- **에러 처리**:
  - 잘못된 인증 정보 시 401 에러
  - 비활성화된 계정 시 403 에러

#### 2.1.3 로그아웃
**FR-AUTH-003: 로그아웃**
- **설명**: 로그인된 사용자가 로그아웃할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: Refresh Token
- **처리**: Refresh Token을 데이터베이스에서 삭제
- **출력**: 성공 메시지

#### 2.1.4 토큰 갱신
**FR-AUTH-004: Access Token 재발급**
- **설명**: Refresh Token을 사용하여 새로운 Access Token을 발급받을 수 있다
- **우선순위**: 필수 (P0)
- **입력**: Refresh Token
- **출력**: 새로운 Access Token
- **검증 규칙**:
  - Refresh Token 유효성 확인
  - 만료 시간 확인
- **에러 처리**:
  - 유효하지 않은 토큰 시 401 에러

---

### 2.2 사용자 관리

#### 2.2.1 사용자 정보 조회
**FR-USER-001: 사용자 프로필 조회**
- **설명**: 특정 사용자의 프로필 정보를 조회할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: User ID
- **출력**:
  - 닉네임
  - 이메일
  - 프로필 이미지 URL
- **권한**: 인증된 사용자만 조회 가능

#### 2.2.2 사용자 정보 수정
**FR-USER-002: 사용자 프로필 수정**
- **설명**: 사용자가 자신의 프로필 정보를 수정할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 닉네임 (선택, 10자 이하)
  - 프로필 이미지 URL (선택)
- **출력**: 수정된 프로필 정보
- **검증 규칙**:
  - 본인 프로필만 수정 가능
  - 닉네임 중복 확인
- **에러 처리**:
  - 권한 없음 시 403 에러
  - 닉네임 중복 시 409 에러

#### 2.2.3 비밀번호 변경
**FR-USER-003: 비밀번호 변경**
- **설명**: 사용자가 자신의 비밀번호를 변경할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 새 비밀번호
  - 새 비밀번호 확인
- **검증 규칙**:
  - 비밀번호 정책 검증
  - 비밀번호 확인 일치 여부
- **에러 처리**:
  - 비밀번호 불일치 시 400 에러

#### 2.2.4 회원 탈퇴
**FR-USER-004: 회원 탈퇴 (계정 비활성화)**
- **설명**: 사용자가 자신의 계정을 비활성화할 수 있다
- **우선순위**: 필수 (P0)
- **처리**: 사용자 상태를 INACTIVE로 변경
- **참고**: 실제 데이터는 삭제되지 않음 (GDPR 등 법적 요구사항 고려 필요)

---

### 2.3 게시글 관리

#### 2.3.1 게시글 작성
**FR-POST-001: 게시글 작성**
- **설명**: 인증된 사용자가 새로운 게시글을 작성할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 제목 (필수, 27자 이하)
  - 내용 (필수, LONGTEXT)
  - 이미지 URL (선택, 다중 가능)
- **출력**: 생성된 게시글 ID
- **초기 상태**: ACTIVE
- **권한**: 인증된 사용자만 작성 가능

#### 2.3.2 게시글 목록 조회
**FR-POST-002: 게시글 목록 조회**
- **설명**: 게시글 목록을 페이지네이션과 정렬 옵션으로 조회할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - offset (페이지 시작 위치, 기본값: 0)
  - limit (페이지 크기, 기본값: 10)
  - sort (정렬 기준: latest=최신순, likes=좋아요순)
- **출력**:
  - 게시글 목록 (작성자 정보 포함)
  - 전체 게시글 수 (total_count)
- **필터링**: ACTIVE 상태의 게시글만 조회
- **권한**: 누구나 조회 가능 (인증 불필요)

#### 2.3.3 게시글 상세 조회
**FR-POST-003: 게시글 상세 조회**
- **설명**: 특정 게시글의 상세 정보를 조회할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: 게시글 ID
- **출력**:
  - 게시글 정보 (제목, 내용, 이미지)
  - 작성자 정보 (닉네임, 프로필 이미지)
  - 통계 정보 (좋아요수, 댓글수, 조회수)
  - 생성/수정 시간
- **부가 기능**: 조회수 자동 증가
- **권한**: 누구나 조회 가능

#### 2.3.4 게시글 수정
**FR-POST-004: 게시글 수정**
- **설명**: 게시글 작성자가 자신의 게시글을 수정할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 제목 (선택)
  - 내용 (선택)
  - 이미지 URL (선택)
- **출력**: 수정된 게시글 정보
- **검증 규칙**: 작성자 본인만 수정 가능
- **에러 처리**:
  - 권한 없음 시 403 에러
  - 게시글 없음 시 404 에러

#### 2.3.5 게시글 삭제
**FR-POST-005: 게시글 삭제 (비활성화)**
- **설명**: 게시글 작성자가 자신의 게시글을 삭제할 수 있다
- **우선순위**: 필수 (P0)
- **처리**: 게시글 상태를 DELETED로 변경
- **검증 규칙**: 작성자 본인만 삭제 가능
- **에러 처리**: 권한 없음 시 403 에러
- **참고**: 실제 데이터는 삭제되지 않음 (소프트 삭제)

---

### 2.4 댓글 관리

#### 2.4.1 댓글 작성
**FR-COMMENT-001: 댓글 작성**
- **설명**: 인증된 사용자가 게시글에 댓글을 작성할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 게시글 ID
  - 댓글 내용 (필수, 200자 이하)
- **출력**: 생성된 댓글 정보 (작성자 정보 포함)
- **부가 기능**: 게시글의 댓글 수 자동 증가
- **권한**: 인증된 사용자만 작성 가능

#### 2.4.2 댓글 목록 조회
**FR-COMMENT-002: 댓글 목록 조회**
- **설명**: 특정 게시글의 댓글 목록을 조회할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - 게시글 ID
  - offset (기본값: 0)
  - limit (기본값: 10)
- **출력**:
  - 댓글 목록 (작성자 정보 포함)
  - 전체 댓글 수
- **정렬**: 작성일시 오름차순 (오래된 순)
- **필터링**: ACTIVE 상태의 댓글만 조회
- **권한**: 누구나 조회 가능

#### 2.4.3 댓글 수정
**FR-COMMENT-003: 댓글 수정**
- **설명**: 댓글 작성자가 자신의 댓글을 수정할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: 댓글 내용 (200자 이하)
- **출력**: 수정된 댓글 정보
- **검증 규칙**: 작성자 본인만 수정 가능
- **에러 처리**: 권한 없음 시 403 에러

#### 2.4.4 댓글 삭제
**FR-COMMENT-004: 댓글 삭제 (비활성화)**
- **설명**: 댓글 작성자가 자신의 댓글을 삭제할 수 있다
- **우선순위**: 필수 (P0)
- **처리**: 댓글 상태를 DELETED로 변경
- **부가 기능**: 게시글의 댓글 수 자동 감소
- **검증 규칙**: 작성자 본인만 삭제 가능
- **에러 처리**: 권한 없음 시 403 에러

---

### 2.5 좋아요 기능

#### 2.5.1 게시글 좋아요
**FR-LIKE-001: 게시글 좋아요 추가**
- **설명**: 인증된 사용자가 게시글에 좋아요를 추가할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: 게시글 ID
- **출력**: 현재 좋아요 수
- **검증 규칙**: 한 사용자당 한 게시글에 한 번만 좋아요 가능
- **부가 기능**: 게시글의 좋아요 수 자동 증가
- **에러 처리**: 중복 좋아요 시 409 에러
- **권한**: 인증된 사용자만 가능

#### 2.5.2 게시글 좋아요 취소
**FR-LIKE-002: 게시글 좋아요 취소**
- **설명**: 사용자가 자신이 추가한 좋아요를 취소할 수 있다
- **우선순위**: 필수 (P0)
- **입력**: 게시글 ID
- **출력**: 현재 좋아요 수
- **부가 기능**: 게시글의 좋아요 수 자동 감소
- **권한**: 인증된 사용자만 가능

#### 2.5.3 내가 좋아요한 게시글 목록
**FR-LIKE-003: 좋아요한 게시글 목록 조회**
- **설명**: 사용자가 자신이 좋아요한 게시글 목록을 조회할 수 있다
- **우선순위**: 필수 (P0)
- **입력**:
  - offset (기본값: 0)
  - limit (기본값: 10)
- **출력**:
  - 게시글 목록
  - 전체 개수
- **권한**: 인증된 사용자만 자신의 목록 조회 가능

---

### 2.6 이미지 관리

#### 2.6.1 이미지 정보 저장
**FR-IMAGE-001: 이미지 정보 저장**
- **설명**: 이미지 URL과 메타데이터를 데이터베이스에 저장한다
- **우선순위**: 필수 (P0)
- **입력**:
  - 이미지 URL (필수)
  - 파일 크기 (선택)
  - 원본 파일명 (선택)
- **출력**: 이미지 ID
- **용도**: 프로필 이미지, 게시글 이미지

#### 2.6.2 게시글 이미지 연결
**FR-IMAGE-002: 게시글 이미지 관리**
- **설명**: 게시글에 여러 이미지를 순서대로 연결할 수 있다
- **우선순위**: 필수 (P0)
- **처리**: post_images 브릿지 테이블 사용
- **부가 기능**: display_order로 이미지 순서 관리

#### 2.6.3 S3 연동 준비
**FR-IMAGE-003: S3 업로드 인터페이스**
- **설명**: 추후 S3 연동을 위한 서비스 인터페이스를 정의한다
- **우선순위**: 중 (P1)
- **현재**: 외부 URL만 받아서 저장
- **향후**: S3 직접 업로드 구현

---

## 3. 비기능 요구사항

### 3.1 보안 (Security)

**NFR-SEC-001: 인증 및 권한**
- JWT 기반 토큰 인증
- Access Token: 30분 만료
- Refresh Token: 7일 만료
- 토큰은 RDB(user_tokens 테이블)에 저장 관리

**NFR-SEC-002: 비밀번호 보안**
- BCrypt 암호화 저장
- 비밀번호 정책:
  - 8자 이상, 20자 이하
  - 대문자 최소 1개
  - 소문자 최소 1개
  - 특수문자 최소 1개

**NFR-SEC-003: API 보안**
- HTTPS 사용 (배포 시)
- CORS 설정
- SQL Injection 방지 (JPA Parameterized Query)
- XSS 방지 (입력 검증)

**NFR-SEC-004: Rate Limiting**
- API 요청 제한: 분당 100회
- 사용자 IP 기반 제한
- 429 에러 응답

---

### 3.2 성능 (Performance)

**NFR-PERF-001: 응답 시간**
- API 평균 응답 시간: < 500ms
- 게시글 목록 조회: < 300ms
- 게시글 상세 조회: < 200ms

**NFR-PERF-002: 데이터베이스 최적화**
- 적절한 인덱스 사용 (DDL.md 기준)
- N+1 문제 방지 (Fetch Join 활용)
- 커넥션 풀 설정 (HikariCP)

**NFR-PERF-003: 페이지네이션**
- 대량 데이터 조회 시 필수
- **기본 방식**: Offset/Limit (웹 환경)
  - 구현: `GET /posts?offset=0&limit=10`
  - 장점: 구현 단순, 페이지 번호 네비게이션 가능
  - 단점: Offset이 클수록 성능 저하
- **모바일 최적화**: Cursor 기반 페이지네이션 고려
  - 구현: `GET /posts?cursor=last_post_id&limit=20`
  - 장점: 무한 스크롤 최적화, 실시간 삽입에 안전, 높은 성능
  - 단점: 특정 페이지 직접 이동 불가
- **설정**:
  - 웹: limit 기본값 10
  - 모바일: limit 기본값 20 (적게, 자주 요청)

---

### 3.3 확장성 (Scalability)

**NFR-SCALE-001: 아키텍처**
- 3-Layer Architecture (Controller-Service-Repository)
- 관심사 분리 원칙
- 느슨한 결합 (Interface 기반 설계)

**NFR-SCALE-002: 캐싱 전략 (추후)**
- Redis 도입 고려
- 토큰 관리 최적화
- 자주 조회되는 데이터 캐싱

---

### 3.4 신뢰성 (Reliability)

**NFR-REL-001: 에러 처리**
- 중앙화된 예외 처리 (GlobalExceptionHandler)
- 명확한 에러 메시지 코드화
- 표준 HTTP 상태 코드 사용

**NFR-REL-002: 로깅**
- 모든 API 요청/응답 로깅
- 에러 스택 트레이스 로깅
- 로그 레벨 설정 (INFO, DEBUG, ERROR)

**NFR-REL-003: 데이터 무결성**
- Foreign Key 제약조건 사용
- 트랜잭션 관리
- 동시성 제어 (Optimistic/Pessimistic Locking)

---

### 3.5 유지보수성 (Maintainability)

**NFR-MAINT-001: 코드 품질**
- Lombok으로 보일러플레이트 감소
- 의미 있는 네이밍 컨벤션
- 주석 및 문서화

**NFR-MAINT-002: 테스트**
- 단위 테스트 커버리지 60% 이상
- Service Layer 중점 테스트
- JUnit 5 + Mockito 사용

**NFR-MAINT-003: 문서화**
- API 명세 문서 (API.md)
- 데이터베이스 스키마 문서 (DDL.md)
- 개발 가이드 (CLAUDE.md)

---

## 4. 데이터 요구사항

### 4.1 데이터 모델

#### 핵심 엔티티
- **User**: 사용자 정보
- **Post**: 게시글
- **Comment**: 댓글
- **PostLike**: 게시글 좋아요
- **Image**: 이미지 메타데이터
- **UserToken**: 인증 토큰
- **PostStats**: 게시글 통계
- **PostImage**: 게시글-이미지 연결

#### 관계
- User 1 : N Post
- User 1 : N Comment
- User 1 : N PostLike
- Post 1 : N Comment
- Post 1 : N PostLike
- Post 1 : 1 PostStats
- Post M : N Image (via PostImage)
- User N : 1 Image (프로필, 이미지 재사용 허용)

### 4.2 데이터 보존
- **소프트 삭제**: 게시글, 댓글, 사용자는 상태만 변경 (DELETED/INACTIVE)
- **하드 삭제**: 토큰은 만료 시 실제 삭제 (정기 배치 작업)
- **데이터 보관**: 법적 요구사항 고려 필요 (GDPR 등)

---

## 5. 제약사항 및 가정

### 5.1 기술적 제약사항
- **Java 버전**: Java 24 사용
- **Spring Boot 버전**: 3.5.6
- **데이터베이스**: MySQL 8.0+
- **토큰 저장소**: RDB (추후 Redis 전환 고려)

### 5.2 비즈니스 제약사항
- **현재 범위**: 백엔드 API만 개발 (프론트엔드 별도)
- **이미지 저장**: S3 연동은 추후 (현재는 URL만 저장)
- **배포 환경**: 추후 결정

### 5.3 가정사항
- 사용자는 올바른 이메일 주소를 입력한다
- 프로필 이미지와 게시글 이미지는 외부에서 호스팅된다
- 동시 접속자 수는 초기에는 많지 않다 (확장 대비 설계)


