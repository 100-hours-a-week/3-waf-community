# PLAN.md - KTB Community 프로젝트 구현 계획

## 프로젝트 개요

**프로젝트명**: KTB Community Platform
**목적**: Spring Boot 기반 RESTful API 커뮤니티 백엔드 서비스
**기술 스택**: Spring Boot 3.5.6, Java 24, MySQL 8.0+, JPA/Hibernate
**저장소 관리**: S3 Object Storage (추후 도입)

---

## 문서 구조

이 프로젝트는 체계적인 문서화를 통해 관리됩니다:

- **@docs/PLAN.md**: 전체 프로젝트 구현 계획 및 단계별 로드맵 (현재 문서)
- **@docs/PRD.md**: 제품 요구사항 명세서 (Product Requirements Document)
- **@docs/LLD.md**: 저수준 설계 문서 (Low Level Design) - 기술적 구현 상세
- **@docs/DDL.md**: 데이터베이스 스키마 정의
- **@docs/API.md**: REST API 엔드포인트 명세

---

## 전체 구현 로드맵

### Phase 1: 프로젝트 기반 설정 (Week 1)
**목표**: 개발 환경 구축 및 핵심 인프라 설정

#### 1.1 환경 설정
- [x] Spring Boot 프로젝트 생성 (Java 24, Gradle)
- [x] MySQL 8.0+ 데이터베이스 설정
- [x] application.yaml 설정 (단일 파일, 프로파일 없음)
- [x] 프로젝트 패키지 구조 설계 (LLD.md 기준)
  - entity/, enums/, dto/, repository/, service/, controller/, exception/, util/
  - **주의**: domain/, security/ 패키지는 Phase 2에서 추가

#### 1.2 데이터베이스 스키마 구축
- [x] DDL.md 기반 테이블 생성 (수동 실행 완료)
- [x] JPA Entity 클래스 생성 (8개)
  - [x] User, Post, Comment, PostLike (핵심 엔티티)
  - [x] Image, UserToken, PostStats, PostImage (지원 엔티티)
- [x] Enum 클래스 생성 (4개)
  - UserRole (USER, ADMIN), UserStatus (ACTIVE, INACTIVE, DELETED)
  - PostStatus (ACTIVE, DELETED, DRAFT), CommentStatus (ACTIVE, DELETED)
- [ ] Repository 인터페이스 정의 (Phase 1 보류, Phase 2에서 구현)

#### 1.3 기본 설정 및 유틸리티
- [ ] 공통 응답 DTO 구조 설계 (ApiResponse) - Phase 1 보류
- [ ] 예외 처리 핸들러 (GlobalExceptionHandler) - Phase 1 보류
- [x] 로깅 설정 (application.yaml 간단한 설정)
- [x] Lombok 설정 확인

**완료 조건**:
- 프로젝트가 정상적으로 빌드되고 실행됨
- 데이터베이스 연결 및 테이블 생성 확인

---

### Phase 2: 인증 및 사용자 관리 (Week 2-3)
**목표**: JWT 기반 인증 시스템 및 사용자 CRUD 구현

#### 2.1 JWT 인증 시스템 구현
- [ ] JWT 토큰 생성/검증 유틸리티 클래스
  - Access Token (30분 만료)
  - Refresh Token (7일 만료)
- [ ] UserToken 엔티티 및 RDB 기반 토큰 관리
- [ ] Spring Security 설정
  - JWT 필터 체인 구성
  - 인증/인가 처리
- [ ] 비밀번호 암호화 (BCryptPasswordEncoder)

#### 2.2 인증 API 구현
- [ ] POST /auth/login - 로그인
- [ ] POST /auth - 로그인 (대체 엔드포인트)
- [ ] POST /auth/logout - 로그아웃
- [ ] DELETE /auth - 로그아웃 (대체 엔드포인트)
- [ ] POST /auth/refresh_token - 토큰 갱신

#### 2.3 사용자 관리 API 구현
- [ ] POST /users/signup - 회원가입
- [ ] POST /users - 회원가입 (대체 엔드포인트)
- [ ] GET /users/{userID} - 사용자 정보 조회
- [ ] PATCH /users/{userID} - 사용자 정보 수정
- [ ] PATCH /users/{userID}/password - 비밀번호 변경
- [ ] PUT /users/{userID} - 회원 탈퇴 (상태 변경)

#### 2.4 비밀번호 정책 구현
- [ ] 비밀번호 검증 로직
  - 8자 이상, 20자 이하
  - 대문자 최소 1개
  - 소문자 최소 1개
  - 특수문자 최소 1개

#### 2.5 PostStats 동시성 제어 구현
- [ ] PostStatsRepository 원자적 UPDATE 메서드 구현
  - `incrementViewCount()`: 조회수 증가
  - `incrementLikeCount()` / `decrementLikeCount()`: 좋아요 증감
  - `incrementCommentCount()` / `decrementCommentCount()`: 댓글 수 증감
  - **참고**: LLD.md Section 7.2, 12.3
- [ ] Service 계층 통합
  - PostService: 조회수 업데이트
  - PostLikeService: 좋아요 업데이트
  - CommentService: 댓글 수 업데이트
- [ ] 동시성 테스트 작성
  - 동시 좋아요 시나리오 테스트
  - 경계값 테스트 (0 미만 방지)

#### 2.6 Rate Limiting 구현
- [ ] API 요청 제한 (분당 100회)
- [ ] AOP 또는 Interceptor 활용

#### 2.7 단위 테스트 작성
- [ ] AuthService 테스트
  - 로그인 성공/실패 (이메일 없음, 비밀번호 불일치)
  - 로그아웃 처리
  - 토큰 갱신 (유효한 토큰, 만료된 토큰)
- [ ] UserService 테스트
  - 회원가입 (성공, 중복 이메일, 중복 닉네임)
  - 사용자 정보 조회/수정
  - 비밀번호 변경 (정책 검증)
- [ ] UserRepository 테스트
  - findByEmail 쿼리
  - 중복 검증 쿼리
- [ ] PasswordValidator 테스트
  - 비밀번호 정책 검증 (각 규칙별)
- [ ] **목표 커버리지**: Service Layer 80% 이상

**완료 조건**:
- 회원가입 → 로그인 → 토큰 발급 → 인증 필요 API 호출 플로우 정상 작동
- 비밀번호 정책 검증 통과
- Rate Limiting 동작 확인
- **모든 단위 테스트 통과 (Phase 2 기능 안정화)**

---

### Phase 3: 게시글 및 댓글 기능 (Week 4-5)
**목표**: 커뮤니티 핵심 기능 구현

#### 3.1 게시글 CRUD API
- [ ] POST /posts - 게시글 작성
- [ ] GET /posts?offset=0&limit=10&sort=latest - 게시글 목록 조회
- [ ] GET /posts/{postId} - 게시글 상세 조회
- [ ] PATCH /posts/{postId} - 게시글 수정
- [ ] DELETE /posts/{postId} - 게시글 삭제
- [ ] PUT /posts/{postId} - 게시글 상태 변경

#### 3.2 게시글 비즈니스 로직
- [ ] 페이지네이션 처리 (offset/limit)
- [ ] 정렬 기능 (latest: 최신순, likes: 좋아요순)
- [ ] 작성자 권한 검증 (수정/삭제)
- [ ] 게시글 상태 관리 (ACTIVE, DELETED, DRAFT)
- [ ] 조회수 증가 처리

#### 3.3 댓글 CRUD API
- [ ] GET /posts/{postId}/comments - 댓글 목록 조회
- [ ] POST /posts/{postId}/comments - 댓글 작성
- [ ] PATCH /posts/{postId}/{commentId} - 댓글 수정
- [ ] PATCH /comments/{commentID} - 댓글 수정 (대체 엔드포인트)
- [ ] DELETE /posts/{postId}/{commentId} - 댓글 삭제
- [ ] DELETE /comments/{commentID} - 댓글 삭제 (대체 엔드포인트)
- [ ] PUT /posts/{postId}/{commentId} - 댓글 상태 변경
- [ ] PUT /comments/{commentID} - 댓글 상태 변경 (대체 엔드포인트)

#### 3.4 댓글 비즈니스 로직
- [ ] 페이지네이션 처리
- [ ] 작성자 권한 검증
- [ ] 댓글 상태 관리 (ACTIVE, DELETED)
- [ ] 댓글 카운트 자동 업데이트 (PostStats)

#### 3.5 좋아요 기능 API
- [ ] POST /posts/{postId}/like - 좋아요 추가
- [ ] DELETE /posts/{postId}/like - 좋아요 취소
- [ ] GET /users/me/likes - 내가 좋아요한 게시글 목록

#### 3.6 좋아요 비즈니스 로직
- [ ] 중복 좋아요 방지
- [ ] 좋아요 카운트 자동 업데이트 (PostStats)
- [ ] 동시성 처리 고려

#### 3.7 단위 테스트 작성
- [ ] PostService 테스트
  - 게시글 작성 (성공, 권한 없음)
  - 게시글 조회 (단건, 목록, 페이지네이션)
  - 게시글 수정 (성공, 권한 없음, 게시글 없음)
  - 게시글 삭제 (성공, 권한 없음)
  - 정렬 기능 (최신순, 좋아요순)
- [ ] CommentService 테스트
  - 댓글 작성 (성공, 게시글 없음)
  - 댓글 조회 (목록, 페이지네이션)
  - 댓글 수정/삭제 (성공, 권한 없음)
  - 댓글 카운트 자동 업데이트 검증
- [ ] LikeService 테스트
  - 좋아요 추가 (성공, 중복 방지)
  - 좋아요 취소 (성공, 좋아요 없음)
  - 좋아요 카운트 자동 업데이트 검증
- [ ] PostRepository 테스트
  - 정렬 쿼리 (latest, likes)
  - 페이지네이션 쿼리
  - N+1 문제 검증 (Fetch Join)
- [ ] **목표 커버리지**: Service Layer 80% 이상

**완료 조건**:
- 게시글 작성 → 조회 → 수정 → 삭제 플로우 정상 작동
- 댓글 작성 → 조회 → 수정 → 삭제 플로우 정상 작동
- 좋아요 추가 → 취소 → 목록 조회 정상 작동
- 권한 검증 정상 작동 (본인만 수정/삭제 가능)
- **모든 단위 테스트 통과 (Phase 3 기능 안정화)**

---

### Phase 4: 이미지 처리 및 통계 (Week 6)
**목표**: 이미지 관리 및 게시글 통계 기능 구현

#### 4.1 이미지 테이블 연동
- [ ] Image 엔티티 JPA 매핑
- [ ] PostImage 브릿지 테이블 처리
- [ ] 프로필 이미지 처리 (User-Image 연관)
- [ ] 게시글 이미지 순서 관리 (display_order)

#### 4.2 S3 연동 준비 (구현은 추후)
- [ ] S3 클라이언트 설정 클래스 준비 (주석 처리)
- [ ] 이미지 업로드 서비스 인터페이스 정의
- [ ] 현재는 외부 URL만 받아서 저장

#### 4.3 게시글 통계 기능
- [ ] PostStats 자동 업데이트
  - 좋아요 카운트
  - 댓글 카운트
  - 조회수 카운트
- [ ] 통계 기반 정렬 (인기순)

#### 4.4 단위 테스트 작성
- [ ] ImageService 테스트
  - 이미지 URL 저장 (성공, 유효하지 않은 URL)
  - 게시글-이미지 연결 (성공, 순서 관리)
  - 프로필 이미지 업데이트
- [ ] PostStats 업데이트 테스트
  - 좋아요 카운트 증가/감소
  - 댓글 카운트 증가/감소
  - 조회수 증가
  - 동시성 처리 검증 (@Version)
- [ ] **목표 커버리지**: Service Layer 80% 이상

**완료 조건**:
- 게시글/프로필 이미지 URL 저장 및 조회 정상 작동
- 통계 자동 업데이트 확인
- S3 연동을 위한 인터페이스 준비 완료
- **모든 단위 테스트 통과 (Phase 4 기능 안정화)**

---

### Phase 5: 테스트 및 문서화 (Week 7)
**목표**: 단위 테스트 작성 및 API 문서 정리

#### 5.1 단위 테스트 작성
- [ ] Service Layer 테스트
  - UserService 테스트
  - PostService 테스트
  - CommentService 테스트
  - AuthService 테스트
- [ ] Repository Layer 테스트
- [ ] 테스트 커버리지 60% 이상 목표

#### 5.2 API 문서화
- [ ] API.md 최종 검토 및 수정
- [ ] Postman Collection 작성
- [ ] 예제 요청/응답 업데이트

#### 5.3 코드 품질 개선
- [ ] 코드 리뷰 및 리팩토링
- [ ] 불필요한 주석 제거
- [ ] 네이밍 컨벤션 통일

**완료 조건**:
- 모든 핵심 서비스 단위 테스트 통과
- API 문서 최신화 완료
- 코드 리뷰 완료

---

## 기술적 고려사항

### 보안
- JWT 토큰은 RDB(user_tokens 테이블)에 저장 관리
- 비밀번호는 BCrypt 암호화
- Rate Limiting으로 API 남용 방지
- SQL Injection 방지 (JPA Parameterized Query)

### 성능
- 데이터베이스 인덱스 최적화 (DDL.md 기준)
- N+1 문제 방지 (Fetch Join 활용)
- 페이지네이션으로 대량 데이터 처리

### 확장성
- 3-Layer Architecture로 관심사 분리
- Service Layer에서 비즈니스 로직 캡슐화
- S3 전환을 위한 인터페이스 기반 설계

### 유지보수성
- 공통 응답 형식 표준화
- 예외 처리 중앙화 (GlobalExceptionHandler)
- 의미 있는 에러 메시지 코드화

---

## 추후 확장 계획 (Phase 6+)

### 고도화 기능
- [ ] Admin 관리 기능 (사용자/게시글 관리)
- [ ] 게시글 검색 기능 (제목/내용/작성자)
- [ ] 게시글 임시저장 (DRAFT) 기능 완성
- [ ] 알림 기능 (댓글, 좋아요 알림)

### 인프라 개선
- [ ] Redis 도입 (토큰 관리, 캐싱)
- [ ] S3 이미지 업로드 실제 구현
- [ ] Docker 컨테이너화
- [ ] CI/CD 파이프라인 구축

### 모니터링 및 운영
- [ ] APM 도구 연동 (Prometheus, Grafana)
- [ ] 로그 수집 및 분석
- [ ] 성능 모니터링 대시보드

---

## 리스크 및 대응 방안

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| JWT RDB 관리 성능 저하 | 중 | 인덱스 최적화, 만료 토큰 정기 삭제, 추후 Redis 전환 |
| 동시성 이슈 (좋아요, 조회수) | 중 | Optimistic Locking 또는 Pessimistic Locking 적용 |
| 대용량 이미지 처리 | 중 | S3 도입 전까지 외부 URL만 처리, 파일 크기 제한 |
| Rate Limiting 우회 | 중 | IP 기반 + 사용자 기반 복합 제한 |
| 데이터베이스 부하 | 저 | 인덱스 활용, 쿼리 최적화, 커넥션 풀 설정 |

---

## 마일스톤 타임라인

```
Week 1  : Phase 1 - 프로젝트 기반 설정
Week 2-3: Phase 2 - 인증 및 사용자 관리
Week 4-5: Phase 3 - 게시글 및 댓글 기능
Week 6  : Phase 4 - 이미지 처리 및 통계
Week 7  : Phase 5 - 테스트 및 문서화
Week 8+ : Phase 6+ - 고도화 및 배포 준비
```

---

## 참고 문서

- **@docs/PRD.md**: 제품 요구사항 상세
- **@docs/LLD.md**: 기술 설계 상세
- **@docs/DDL.md**: 데이터베이스 스키마
- **@docs/API.md**: API 엔드포인트 명세
- **@docs/CLAUDE.md**: 개발 가이드 및 명령어

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-09-30 | 1.0 | 초기 계획 수립 | Claude Code |